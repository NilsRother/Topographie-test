
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Topographie Quiz - Pro Version</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; background: #aad3df; }

        /* UI Styling */
        .leaflet-control-layers { border-radius: 8px !important; padding: 10px !important; }

        /* QUIZ PANEL */
        #quiz-panel {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 2000; background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; min-width: 300px;
        }
        .quiz-btn {
            background: #2980b9; color: white; border: none; padding: 10px 20px;
            border-radius: 25px; cursor: pointer; font-weight: bold; margin: 5px;
        }
        .quiz-btn.stop { background: #c0392b; }
        #quiz-question { font-size: 1.3em; font-weight: bold; margin: 10px 0; color: #2c3e50; }
        
        /* Suchfeld */
        #search-container { position: absolute; top: 20px; left: 60px; z-index: 1000; width: 300px; }
        #search-input { 
            width: 100%; padding: 12px; border-radius: 25px; border: none; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); outline: none;
        }
        #search-results { 
            background: white; border-radius: 10px; margin-top: 5px; 
            max-height: 300px; overflow-y: auto; display: none; 
        }
        .search-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .search-item:hover { background: #f0f0f0; }

        body.quiz-mode #search-container { display: none; }
    </style>
</head>
<body>

<div id="search-container">
    <input type="text" id="search-input" placeholder="ðŸ” Suche nach Objekten...">
    <div id="search-results"></div>
</div>

<div id="quiz-panel">
    <div id="quiz-start-view">
        <h3 style="margin:0 0 10px 0;">Topographie Quiz</h3>
        <button class="quiz-btn" onclick="startQuiz()">Quiz jetzt starten</button>
    </div>
    <div id="quiz-game-view" style="display:none;">
        <div id="quiz-score">Punkte: 0</div>
        <div id="quiz-question">Suchen...</div>
        <div id="quiz-feedback" style="height: 20px; margin-bottom: 10px; font-weight: bold;"></div>
        <button class="quiz-btn" onclick="skipQuestion()">Ãœberspringen</button>
        <button class="quiz-btn stop" onclick="stopQuiz()">Beenden</button>
    </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- KONFIGURATION ---
    const map = L.map('map', { zoomControl: false }).setView([50, 15], 4);
    L.control.zoom({ position: 'topright' }).addTo(map);

    L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { maxZoom: 17 }).addTo(map);

    // Layer Gruppen
    const lgGebirge = L.layerGroup().addTo(map);
    const lgFluesse = L.layerGroup().addTo(map);
    const lgStaedte = L.layerGroup().addTo(map);
    const lgSeen = L.layerGroup().addTo(map);

    let searchIndex = [];
    let quizActive = false;
    let quizPool = [];
    let currentItem = null;
    let score = 0;

    // --- STYLING (EXAKTE UMRANDUNG) ---
    
    // Gebirge wie bei Google Maps (Scharfe Kontur + FlÃ¤che)
    const styleGebirge = {
        color: "#3e2723",      // Sehr dunkle Umrandung
        weight: 2,             // Exakte Linie
        fillColor: "#795548",  // Gebirgsfarbe
        fillOpacity: 0.4       // Transparenz
    };

    // FlÃ¼sse "Kanal-Look" (Dunkler Rand, helles Wasser)
    function createRiver(coords, name) {
        // Schicht 1: Der dunkle Uferrand (Outline)
        const border = L.polyline(coords, { color: '#003366', weight: 6, opacity: 0.7 });
        // Schicht 2: Das helle Wasser
        const water = L.polyline(coords, { color: '#5dade2', weight: 3, opacity: 1 });
        // Schicht 3: Klick-Zone
        const clickZone = L.polyline(coords, { color: 'transparent', weight: 15 });

        const group = L.featureGroup([border, water, clickZone]);
        group.quizData = { name: name, type: "Fluss" };
        group.on('click', (e) => handleSelection(e, group));
        group.addTo(lgFluesse);
        
        searchIndex.push({ name: name, layer: group, type: "Fluss", group: lgFluesse });
    }

    function addArea(group, coords, name, style, type) {
        const poly = L.polygon(coords, style);
        poly.quizData = { name: name, type: type };
        poly.on('click', (e) => handleSelection(e, poly));
        poly.addTo(group);
        searchIndex.push({ name: name, layer: poly, type: type, group: group });
    }

    // --- DATEN (BEISPIELE AUS DEINER DATEI ÃœBERNOMMEN) ---
    
    // Gebirge
    addArea(lgGebirge, [[43.8,7.2], [45.0,6.5], [47.5,9.5], [48.2,16.2], [46.0,11.0]], "Alpen", styleGebirge, "Gebirge");
    addArea(lgGebirge, [[43.3,-1.8], [42.8,3.2], [43.1,1.5]], "PyrenÃ¤en", styleGebirge, "Gebirge");
    addArea(lgGebirge, [[48.2,17], [49.8,22], [45.5,26.8], [47,22.5]], "Karpaten", styleGebirge, "Gebirge");

    // FlÃ¼sse (Verbesserter Verlauf)
    createRiver([[48.0,8.2], [48.5,13.5], [48.2,16.4], [47.8,19.0], [44.8,20.5], [45.2,29.6]], "Donau");
    createRiver([[46.6,9.4], [47.5,7.6], [50.0,8.3], [51.8,6.0], [51.9,4.1]], "Rhein");
    createRiver([[50.7,15.6], [51.5,13.5], [53.0,11.0], [53.9,8.6]], "Elbe");
    createRiver([[57.2,32.5], [56.2,49.5], [48.7,44.5], [45.8,48.0]], "Wolga");

    // StÃ¤dte
    const staedte = [["Berlin", [52.52, 13.4]], ["Paris", [48.85, 2.35]], ["Rom", [41.9, 12.49]], ["London", [51.5, -0.12]]];
    staedte.forEach(s => {
        const m = L.circleMarker(s[1], { radius: 6, color: '#000', fillColor: '#fff', fillOpacity: 1 });
        m.quizData = { name: s[0], type: "Stadt" };
        m.on('click', (e) => handleSelection(e, m));
        m.addTo(lgStaedte);
        searchIndex.push({ name: s[0], layer: m, type: "Stadt", group: lgStaedte });
    });

    // --- LOGIK ---

    function handleSelection(e, layer) {
        if (quizActive) {
            checkAnswer(layer.quizData);
        } else {
            L.popup().setLatLng(e.latlng)
                .setContent(`<b>${layer.quizData.type}:</b> ${layer.quizData.name}`)
                .openOn(map);
        }
    }

    function startQuiz() {
        quizPool = searchIndex.filter(i => map.hasLayer(i.group));
        if (quizPool.length === 0) return alert("Aktiviere Layer fÃ¼r das Quiz!");
        
        quizActive = true;
        score = 0;
        document.body.classList.add('quiz-mode');
        document.getElementById('quiz-start-view').style.display = 'none';
        document.getElementById('quiz-game-view').style.display = 'block';
        nextQuestion();
    }

    function stopQuiz() {
        quizActive = false;
        document.body.classList.remove('quiz-mode');
        document.getElementById('quiz-start-view').style.display = 'block';
        document.getElementById('quiz-game-view').style.display = 'none';
    }

    function nextQuestion() {
        if (quizPool.length === 0) {
            document.getElementById('quiz-question').innerText = "Fertig! Alles gefunden.";
            return;
        }
        currentItem = quizPool[Math.floor(Math.random() * quizPool.length)];
        document.getElementById('quiz-question').innerText = `Wo ist: ${currentItem.name}?`;
        document.getElementById('quiz-feedback').innerText = "";
    }

    function checkAnswer(clicked) {
        const feedback = document.getElementById('quiz-feedback');
        if (clicked.name === currentItem.name) {
            feedback.innerHTML = "<span style='color:green'>Richtig! ðŸŽ‰</span>";
            score++;
            quizPool = quizPool.filter(i => i.name !== currentItem.name);
            setTimeout(nextQuestion, 1200);
        } else {
            feedback.innerHTML = `<span style='color:red'>Nein, das ist ${clicked.name}</span>`;
        }
        document.getElementById('quiz-score').innerText = `Punkte: ${score}`;
    }

    function skipQuestion() {
        nextQuestion();
    }

    // Suche
    const sInput = document.getElementById('search-input');
    const sRes = document.getElementById('search-results');

    sInput.addEventListener('input', function() {
        const val = this.value.toLowerCase();
        sRes.innerHTML = '';
        if (val.length < 2) { sRes.style.display = 'none'; return; }
        const matches = searchIndex.filter(i => i.name.toLowerCase().includes(val)).slice(0,5);
        if (matches.length > 0) {
            sRes.style.display = 'block';
            matches.forEach(m => {
                const d = document.createElement('div');
                d.className = 'search-item';
                d.innerText = `${m.name} (${m.type})`;
                d.onclick = () => {
                    if (m.layer.getBounds) map.fitBounds(m.layer.getBounds());
                    else map.setView(m.layer.getLatLng(), 8);
                    sRes.style.display = 'none';
                };
                sRes.appendChild(d);
            });
        }
    });
</script>
</body>
</html>
