<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Geo-Master Europa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; background: #aad3df; }
        #map { height: 100vh; width: 100%; z-index: 1; }

        /* --- UI ELEMENTE --- */
        .hidden { display: none !important; }

        /* Men√º-Button (Zahnrad) */
        #menu-toggle {
            position: absolute; top: 15px; left: 15px; z-index: 3000;
            background: white; border: none; border-radius: 50%; width: 45px; height: 45px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); cursor: pointer; font-size: 20px;
        }

        /* Haupt-Overlay (Einstellungen) */
        #settings-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
            z-index: 4000; display: flex; align-items: center; justify-content: center;
        }

        .card {
            background: white; padding: 25px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 380px; text-align: center;
        }

        .mode-btn {
            width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 10px;
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-exam { background: #3498db; color: white; }
        .btn-classic { background: #f39c12; color: white; }
        .btn-close { background: #ecf0f1; color: #333; margin-top: 15px; }

        /* Layer-Auswahl */
        .layer-settings { text-align: left; margin: 15px 0; padding: 10px; background: #f9f9f9; border-radius: 10px; }
        .layer-settings label { display: block; margin: 5px 0; cursor: pointer; }

        /* Quiz-Panel (unten) */
        .quiz-panel {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: white; border-radius: 15px;
            padding: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 2000;
        }

        /* Multiple Choice Buttons */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .opt-btn { 
            background: #f8f9fa; border: 2px solid #ddd; padding: 10px; border-radius: 8px;
            cursor: pointer; font-weight: 600; font-size: 0.9rem;
        }
        .opt-btn.correct { background: #2ecc71 !important; color: white; border-color: #27ae60; }
        .opt-btn.wrong { background: #e74c3c !important; color: white; border-color: #c0392b; }

        .progress-bar { height: 6px; background: #eee; border-radius: 3px; margin-bottom: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: #3498db; width: 0%; transition: width 0.3s; }

        /* Beenden Button */
        .exit-btn {
            position: absolute; top: 15px; right: 15px; z-index: 3000;
            background: #e74c3c; color: white; border: none; padding: 8px 15px;
            border-radius: 20px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<button id="menu-toggle" onclick="toggleSettings()">‚öôÔ∏è</button>
<button id="exit-quiz" class="exit-btn hidden" onclick="stopQuiz()">Quiz Beenden</button>

<div id="settings-overlay">
    <div class="card">
        <h2>Europa Geo-Master</h2>
        <p style="color: #666;">W√§hle einen Modus:</p>
        
        <button class="mode-btn btn-exam" onclick="startQuiz('exam')">üéì Fahrschul-Modus (A, B, C)</button>
        <button class="mode-btn btn-classic" onclick="startQuiz('classic')">üìç Klassisch (Auf Karte zeigen)</button>
        
        <div class="layer-settings">
            <small><b>EBENEN:</b></small>
            <label><input type="checkbox" checked onchange="toggleL('gebirge', this)"> Gebirge</label>
            <label><input type="checkbox" checked onchange="toggleL('fluesse', this)"> Fl√ºsse</label>
            <label><input type="checkbox" checked onchange="toggleL('staedte', this)"> St√§dte</label>
        </div>

        <button class="mode-btn btn-close" onclick="toggleSettings()">Nur Karte erkunden</button>
    </div>
</div>

<div id="exam-panel" class="quiz-panel hidden">
    <div class="progress-bar"><div id="exam-fill" class="progress-fill"></div></div>
    <div id="exam-question" style="font-weight: bold; text-align: center; margin-bottom: 10px;">Was ist das?</div>
    <div id="exam-options" class="options-grid"></div>
</div>

<div id="classic-panel" class="quiz-panel hidden" style="text-align: center;">
    <div id="classic-target" style="font-size: 1.2rem; font-weight: bold;">Suche: ...</div>
    <div id="classic-feedback" style="margin-top: 5px; height: 20px;"></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. Karte Initialisieren (Mit Standard OSM f√ºr bessere Stabilit√§t)
    const map = L.map('map', { zoomControl: false }).setView([50, 15], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap'
    }).addTo(map);

    // 2. Layer Gruppen
    const groups = {
        gebirge: L.layerGroup().addTo(map),
        fluesse: L.layerGroup().addTo(map),
        staedte: L.layerGroup().addTo(map)
    };

    let allItems = [];

    // 3. Daten hinzuf√ºgen (Beispielhaft - hier kommen deine Original-Daten rein)
    function addP(group, name, type, coords, isPoint=false) {
        let layer;
        if(isPoint) {
            layer = L.circleMarker(coords, { radius: 6, color: 'black', fillColor: 'white', fillOpacity: 1 });
        } else {
            layer = L.polygon(coords, { color: type==='Gebirge'?'#8B4513':'#2980b9', weight: 2 });
        }
        layer.on('click', (e) => onMapClick(e, name, layer));
        layer.addTo(groups[group]);
        allItems.push({ name, type, layer, group: groups[group] });
    }

    // --- HIER DEINE DATEN (Platzhalter) ---
    addP('gebirge', 'Alpen', 'Gebirge', [[47,10], [48,12], [47,14], [46,12]]);
    addP('gebirge', 'Pyren√§en', 'Gebirge', [[42,0], [43,1], [42,2]]);
    addP('staedte', 'Berlin', 'Stadt', [52.5, 13.4], true);
    addP('staedte', 'Paris', 'Stadt', [48.8, 2.3], true);
    // ---------------------------------------

    // 4. Quiz Logik
    let currentMode = 'explore';
    let currentTarget = null;
    let examStep = 0;
    let score = 0;

    function startQuiz(mode) {
        currentMode = mode;
        toggleSettings(false);
        document.getElementById('exit-quiz').classList.remove('hidden');
        
        if(mode === 'exam') {
            examStep = 0; score = 0;
            document.getElementById('exam-panel').classList.remove('hidden');
            nextExamQ();
        } else {
            document.getElementById('classic-panel').classList.remove('hidden');
            nextClassicQ();
        }
    }

    function stopQuiz() {
        currentMode = 'explore';
        document.getElementById('exit-quiz').classList.add('hidden');
        document.getElementById('exam-panel').classList.add('hidden');
        document.getElementById('classic-panel').classList.add('hidden');
        resetStyles();
        map.setView([50, 15], 4);
    }

    // FAHRSCHUL-LOGIK
    function nextExamQ() {
        const visible = allItems.filter(i => map.hasLayer(i.group));
        currentTarget = visible[Math.floor(Math.random() * visible.length)];
        
        // Markierung auf Karte
        resetStyles();
        currentTarget.layer.setStyle({ color: '#ff00ff', weight: 5 });
        if(currentTarget.layer.getBounds) map.fitBounds(currentTarget.layer.getBounds(), {padding:[100,100]});
        else map.setView(currentTarget.layer.getLatLng(), 6);

        // Buttons
        const options = [currentTarget.name];
        while(options.length < 4) {
            let r = visible[Math.floor(Math.random() * visible.length)].name;
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5);

        const container = document.getElementById('exam-options');
        container.innerHTML = '';
        options.forEach(opt => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = opt;
            b.onclick = () => {
                if(opt === currentTarget.name) {
                    b.classList.add('correct');
                    setTimeout(nextExamQ, 1000);
                } else {
                    b.classList.add('wrong');
                }
            };
            container.appendChild(b);
        });
    }

    // KLASSIK-LOGIK
    function nextClassicQ() {
        const visible = allItems.filter(i => map.hasLayer(i.group));
        currentTarget = visible[Math.floor(Math.random() * visible.length)];
        document.getElementById('classic-target').innerText = `Suche: ${currentTarget.name}`;
        document.getElementById('classic-feedback').innerText = "";
    }

    function onMapClick(e, name, layer) {
        if(currentMode === 'explore') {
            L.popup().setLatLng(e.latlng).setContent(`<b>${name}</b>`).openOn(map);
        } else if(currentMode === 'classic') {
            if(name === currentTarget.name) {
                layer.setStyle({ color: '#2ecc71', weight: 5 });
                document.getElementById('classic-feedback').innerHTML = "<b style='color:green'>Richtig!</b>";
                setTimeout(nextClassicQ, 1000);
            } else {
                document.getElementById('classic-feedback').innerHTML = `<span style='color:red'>Das war ${name}</span>`;
            }
        }
    }

    // Hilfsfunktionen
    function toggleSettings(show) {
        const el = document.getElementById('settings-overlay');
        el.style.display = (show === false || el.style.display === 'flex') ? 'none' : 'flex';
    }

    function toggleL(id, cb) {
        if(cb.checked) map.addLayer(groups[id]);
        else map.removeLayer(groups[id]);
    }

    function resetStyles() {
        allItems.forEach(i => {
            if(i.layer.setStyle) i.layer.setStyle({ color: i.type==='Gebirge'?'#8B4513':'#2980b9', weight: 2 });
        });
    }
</script>
</body>
</html>
